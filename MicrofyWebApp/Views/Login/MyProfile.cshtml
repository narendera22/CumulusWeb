@model MicrofyWebApp.Models.UserViewModel
@{
    ViewData["Title"] = "My Profile";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Welcome to Microfy</title>
    <link rel="stylesheet" href="~/lib/jquery/dist/css/jquery-confirm.css" />

    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="~/css/site.css" />
    <style type="text/css">
        .input-group-addon {
            padding: 6px 20px !important;
        }

        a {
            color: #007bff;
            text-decoration: none;
            background-color: transparent;
        }

        .justify-content-lg-center {
            justify-content: right !important;
        }
    </style>
</head>
<body>
    <div class="container" style="padding-left:60px">
        <form class="well form-horizontal" action=" " method="post" id="MyProfile_Form">
            <fieldset>
                <div class="imglogo" style="display:flex;">
                    <img id="img_logo" alt="Logo" src="~/Image/microfy.png" onclick="@("window.location.href='" + @Url.Action("Microfy", "Home") + "'");" />
                    <div class=" col-lg-8" style="padding-top:40px">
                        <center><h2><b>My Profile</b></h2></center>
                    </div>
                </div>
                <!-- Form Name -->
                <!-- Text input-->
                <div class="form-group">
                    <label class="col-md-4 control-label">Full Name</label>
                    <div class="col-md-4 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input name="first_name" id="first_name" placeholder="User Name" class="form-control" readonly type="text" value="@Model.fullName">
                            <span data-alertid="first_name"></span>
                        </div>
                    </div>
                </div>
                @foreach (var d in Model.projects)
                {
                    <div class="form-group">
                        <label class="col-md-4 control-label">Customer Name</label>
                        <div class="col-md-4 inputGroupContainer">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                <input name="cust_name" id="cust_name" placeholder="Customer Name" class="form-control" readonly type="text" value="@d.customerName">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-4 control-label">Project Name</label>
                        <div class="col-md-4 inputGroupContainer">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                <input name="project_name" id="project_name" placeholder="Project Name" class="form-control" readonly type="text" value="@d.projectName">
                            </div>
                        </div>
                    </div>

                }
                <div class="form-group">
                    <label class="col-md-4 control-label">Role</label>
                    <div class="col-md-4 selectContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
                            <input name="role" placeholder="Role" id="txtrole" class="form-control" type="text" value="@Model.userRole" readonly>
                        </div>
                    </div>
                </div>

                <!-- Text input-->


                <div class="form-group">
                    <label class="col-md-4 control-label">Userid</label>
                    <div class="col-md-4 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
                            <input name="userid" id="userid" placeholder="Userid" class="form-control" type="email" readonly value="@Model.username">
                        </div>
                    </div>
                </div>

                <div class="form-group" id="ChangePwd" style="display:block;">
                    <a href="#" class="col-md-4 control-label" onclick="displayPwd()">Show Change Password</a>
                </div>
                <div class="form-group" id="hidePwd" style="display:none;">
                    <a href="#" class="col-md-4 control-label" onclick="hidepwd()"> Hide Change Password</a>
                </div>
                <!-- Text input-->
                <div id="divPassword" style="display:none;">

                    <div class="form-group">
                        <label class="col-md-4 control-label">Password</label>
                        <div class="col-md-4 inputGroupContainer">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                <input name="user_password" type="password" id="user_password" title="Password must contain: Minimum 8 characters atleast 1 Alphabet and 1 Number"
                                       class="form-control" placeholder="Enter Password" required />
                            </div>
                        </div>
                    </div>

                    <!-- Text input-->

                    <div class="form-group">
                        <label class="col-md-4 control-label">Confirm Password</label>
                        <div class="col-md-4 inputGroupContainer">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                <input name="confirm_password" id="confirm_password" placeholder="Confirm Password" class="form-control" required type="password">
                            </div>
                        </div>
                    </div>
                </div>




                <!-- Select Basic -->
                <!-- Success message -->
                @*<div class="alert alert-success" role="alert" id="success_message">Success <i class="glyphicon glyphicon-thumbs-up"></i> Success!.</div>*@

                <!-- Button -->
                <div class="form-group">
                    <div class="col-md-4 control-label">
                        <button type="button" id="btnBack" onclick="@("window.location.href='" + @Url.Action("Microfy", "Home") + "'");" class="btn btn-warning"><span class="glyphicon glyphicon-arrow-left"></span> BACK</button>
                    </div>
                    <div class="col-md-4 control-label" id="updatepwd" style="display:none;">
                        <button type="submit" class="btn btn-warning">Update <span class="glyphicon glyphicon-send"></span></button>
                    </div>
                </div>

            </fieldset>
        </form>
    </div>

    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/jquery/dist/jquery-confirm.js"></script>

    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.js"></script>

    <script src="~/js/site.js" asp-append-version="true"></script>

</body>
</html>
<script type="text/javascript">
    function displayPwd() {
        $('#divPassword').show();
        $('#updatepwd').show();
        $('#ChangePwd').hide();
        $('#hidePwd').show();

    }
    function hidepwd() {
        $('#divPassword').hide();
        $('#updatepwd').hide();
        $('#ChangePwd').show();
        $('#hidePwd').hide();

    }
    window.onload = function () {
        var txtPassword = document.getElementById("user_password");
        var txtConfirmPassword = document.getElementById("confirm_password");
        txtPassword.onchange = ConfirmPassword;
        txtConfirmPassword.onkeyup = ConfirmPassword;
        function ConfirmPassword() {
            txtConfirmPassword.setCustomValidity("");
            if (txtPassword.value != txtConfirmPassword.value) {
                txtConfirmPassword.setCustomValidity("Passwords do not match.");
            }
        }
    }
    $('#MyProfile_Form').submit(function () {
    var username = $('#first_name').val();
    var custname = $('#cust_name').val();
    var projectname = $('#project_name').val();
    var role = $('#txtrole').val();
    var userid = $('#userid').val();
    var password = $('#user_password').val();
    var confrmpassword = $('#confirm_password').val();

    var Projects = [{
        "ProjectName": projectname,
        "CustomerName": custname
    }];

    var UserDetails = {
        "username": userid,
        "password": password,
        "fullName": username,
        "userRole": role,
        "isActive": true,
        "projects": Projects
        }
        var ActivityTracker = {
            "UserName": userid,
            "ActivityType": "ChangePassword",
            "ActivityDetails": "User " + userid+ " has successfully changed password"
        }

        var redirecturl = "/Login/UpdateUser";
        $.post(redirecturl, { "users": UserDetails, "activityTracker": ActivityTracker}, function (data) {
            var title = "";
            var type = "";
            if (data.statusCode == true) {
                title = "Success!!";
                type = "green";
            }
            else {
                title = "Error!!";
                type = "red";
            }
            $.alert({
                    title: title,
                    content: data.responseMessage,
                    type: type,
                    onAction: function () {
                        window.location.href = '@Url.Action("MyProfile","Login")';
                    }
                });
        })
        .fail(function (response) {
           $.alert({
                title: 'Error!!',
                content: response,
                alignMiddle: true,
                type: 'red'
            });
        });
    return false;


});
</script>